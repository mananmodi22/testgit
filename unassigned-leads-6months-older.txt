SELECT ll.`id` as id,l.`created_date`, ll.`addedby` as addedby_id, ll.`assigned_to`, ll.`assigned_to_deleted`, ll.`product_type` as product_type, ll.`callback_date`, ll.`visit_date`, ll.`priority`, ll.`status`, ll.`module_case_link_id`, ll.`visit_not_required`, ll.`incomplete` as incomplete, l.`id` as sub_lead_id, l.`estimate_proporty`, l.`mortgage_remaining`, l.`age_youngest`, l.`calc_life_time_mortgage`, l.`calc_enhanced_lifetime_mortgage_value`, l.`calc_home_reversion_value`, l.`created_date`, l.`address_line1` as property_address_line1, l.`postcode` as property_postcode, l.`point_of_enquiry` as lead_source, l.`introducer_clara`, l.`introducer_self`, l.`introducer_avril`, l.`introducer_chrisprior`, c.`id` as client_id, c.`email_address`, if(LOWER(c.`name`) != LOWER(c.`last_name`),CONCAT(c.`name`, ' ', c.`last_name`),c.`name`) as 'name', c.`preferred_name`, c.`client_interspire_entry`, c.`address_line1` as client_address_line1, c.`postcode` as client_postcode, c.`telephone`, c.`good_number`, pe.`title` AS `point_of_enquiry`, t.`title` AS `title`, if(LOWER(u.`first_name`) != LOWER(u.`last_name`),CONCAT(u.`first_name`, ' ', u.`last_name`),u.`first_name`) as 'assigned_to_name', u1.`company_old` as company, if(ll.`assigned_to` is NULL , '0', '1') as unassignedcase, if( ll.`visit_date` > ll.`callback_date` OR ll.`callback_date` is NULL , IF(ll.`visit_date`='0000-00-00 00:00:00',NULL,ll.`visit_date`), IF(ll.`callback_date`='0000-00-00 00:00:00',NULL,ll.`callback_date`)) as lead_date, mcod.`status` as `mcod_status`, ll.`migration_data`, ll.`archived`, ll.`migrated_case_close` as migrated_case_close, mcl.migrated_case_data, mcca.`date` as completion_date, rc.rc_title as company_name, rm.ram_title as ram_title FROM `module_leads_link` ll INNER JOIN `module_leads` l ON ll.`id` = l.`lead_link_id` INNER JOIN `module_clients` c ON ll.`id` = c.`lead_link_id` LEFT JOIN `users` u ON ll.`assigned_to` = u.`id` or (ll.`assigned_to_deleted_advisor` = u.`id` and ll.`assigned_to` = '' ) LEFT JOIN `users` u1 ON ll.`addedby` = u1.`id` or (ll.`assigned_to_deleted_advisor` = u.`id` and ll.`assigned_to` = '') LEFT JOIN `_name_titles` t ON c.`title` = t.`id` LEFT JOIN `_point_of_enquiry` pe ON l.`point_of_enquiry` = pe.`id` LEFT JOIN `module_case_offer_documents` mcod ON ll.module_case_link_id = mcod.module_case_link_id AND mcod.id = ( SELECT MAX(maxoffer.id) FROM module_case_offer_documents maxoffer WHERE maxoffer.module_case_link_id = ll.module_case_link_id) LEFT JOIN `module_case_completion_application` mcca ON ll.module_case_link_id = mcca.module_case_link_id LEFT JOIN module_case_link mcl ON mcl.id = ll.module_case_link_id LEFT JOIN ram_company rc ON rc.rc_id = l.company LEFT JOIN ram_management rm ON rm.id = l.ram_id WHERE c.`primary_contact` = '1' AND l.duplicate_flag=0 AND l.deleted='0' AND ll.`status` in (1) AND l.duplicate_flag=0 AND l.deleted='0' AND ll.archived=0 AND ll.archive_live_lead=0 AND ll.archived=0 AND ll.archive_live_lead=0 AND DATE_FORMAT(l.`created_date`, "%Y-%m-%d") < DATE_SUB(CURDATE(), INTERVAL 6 MONTH)  AND DATE_FORMAT(ll.`callback_date`, "%Y-%m-%d") < "2017-11-01"  AND ll.`module_case_link_id` IS NULL AND ll.`assigned_to` IS NULL AND l.`primary_lead` = "1" ORDER BY ll.`assigned_to_deleted` DESC, lead_date ASC, l.`created_date` DESC 